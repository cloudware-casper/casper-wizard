<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../casper-wizard/casper-wizard-page.html">

<dom-module id="casper-wizard">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <slot></slot>
  </template>

  <script>
    /**
     * `casper-wizard`
     * Wizard a container for simple dialogs with the infamous prev-next buttons
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class CasperWizard extends Polymer.Element {
      static get is() { return 'casper-wizard'; }
      static get properties() {
        return {
          prop1: {
            type: String,
            value: 'casper-wizard'
          }
        };
      }

      ready () {
        super.ready();
        // console.log("wizard ready", this);

        this._pageIndex = 0;
        this._pages = this.shadowRoot.querySelectorAll('casper-wizard-page');

        this._prevButton = document.createElement('paper-button');
        this._prevButton.textContent = 'previous';
        this._prevButton.raised = true;
        this._prevButton.addEventListener('tap', e => this._gotoPreviousPage(e));
        this._prevButton.classList = 'wizard-previous-button';
        this.shadowRoot.appendChild(this._prevButton);

        this._nextButton = document.createElement('paper-button');
        this._nextButton.textContent = 'next';
        this._nextButton.raised = true;
        this._nextButton.addEventListener('tap', e => this._gotoNextPage(e));
        this._nextButton.classList = 'wizard-next-button';
        this.shadowRoot.appendChild(this._nextButton);

        this._closeButton = document.createElement('a');
        this._closeButton.innerHTML = '<iron-icon icon="casper-icons:cancel"></iron-icon>';
        this._closeButton.addEventListener('tap', e => this._closePage(e));
        this._closeButton.classList = 'wizard-close-button';
        this.shadowRoot.appendChild(this._closeButton);

        this._activatePage(0);
      }

      connectedCallback () {
        super.connectedCallback();
        // console.log("wizard connectedCallback", this);
        
      }

      _gotoPreviousPage (event) {
        if ( this._pageIndex >= 1 ) {
          this._activatePage(this._pageIndex - 1);
        }
      }

      _gotoNextPage (event) {
        if ( this._pageIndex < this._pages.length - 1 ) {
          this._activatePage(this._pageIndex + 1);
        }
      }

      _activatePage (pageIndex) {
        if ( this._pageIndex !== undefined ) {
          this._pages[this._pageIndex].style.display = 'none';
        }
        this._pageIndex = pageIndex;
        this._pages[this._pageIndex].style.display = 'flex';
      }

      _closePage (event) {
        this._pages[this._pageIndex].style.display = 'none';
        this._nextButton.style.display = 'none';
        this._prevButton.style.display = 'none';
        this._closeButton.style.display = 'none';
      }

    }

    window.customElements.define(CasperWizard.is, CasperWizard);
  </script>
</dom-module>
