<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="/bower_components/vaadin-progress-bar/vaadin-progress-bar.html">

<dom-module id="casper-wizard-progress-page">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column;
        padding: 12px;
      }

      vaadin-progress-bar {
        margin-top: 5px;
        margin-bottom:  20px;
        width: 100%;
        height: 20px;
      }

      span {
        color: grey;
      }

      .container-status {
        margin-top: 120px;

      }

      .container-status span {
        text-align: center;
      }

    </style>
    
    <div id="status_panel" class="container-status">
      <template is="dom-repeat" items="{{progressMessages}}">
        <span>[[item.message]]</span>
        <vaadin-progress-bar indeterminate min="0" max="100"></vaadin-progress-bar>
      </template>
    </div>

  </template>

  <script>
    /**
     * `casper-wizard-progress-page`
     * Wizard a container for simple dialogs with the infamous prev-next buttons
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class CasperWizardProgressPage extends Polymer.Element {
      
      static get is () { 
        return 'casper-wizard-progress-page';
      }
      
      static get properties () {
        return {
          progressMessages: {
            type: Object
          },
          progressCount: {
            type: Number,
            value: 1
          }
        };
      }

      ready () {
        super.ready();
      }

      connectedCallback () {
        super.connectedCallback();
        this.setProgressCount(1, true);
      }

      setProgressCount (count, forced) {
        if ( count !== this.progressCount || forced) {
          this.progressCount = count;
          this.progressMessages = null;
          var pdata = Array.apply(null, { length: this.progressCount }).map(function() { return { message: '\xA0' }; });
          pdata[0].message = 'Em fila de espera';
          this.progressMessages = pdata;

          for ( let idx = 1; idx <= this.progressMessages.length; idx++ ) {
            const pbar = this.shadowRoot.querySelector(`vaadin-progress-bar:nth-of-type(${idx})`);
            if ( pbar ) {
              pbar.indeterminate = true;
            }
          }
        }
      }

      updateProgress (index, message, progress) {
        const idx = index || 0;

        if ( message ) {
          this.progressMessages[idx].message = message;
          this.notifyPath('progressMessages.'+idx+'.message');
        }

        if ( progress !== undefined ) {
          const pvalue = parseFloat(progress);

          if ( isNaN(progress) === false ) {
            const pbar = this.shadowRoot.querySelector(`vaadin-progress-bar:nth-of-type(${idx + 1})`);
            pbar.indeterminate = false;
            pbar.value = pvalue;
          }
        }
      }

    }

    window.customElements.define(CasperWizardProgressPage.is, CasperWizardProgressPage);
  </script>
</dom-module>